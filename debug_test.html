<!DOCTYPE html>
<html>
<head>
    <title>Debug Test</title>
</head>
<body>
    <h1>Debug Console</h1>
    <div id="output"></div>
    
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        let characters = [];
        
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                characters = data.characters.filter(isCharacter);
                console.log('Loaded', characters.length, 'characters');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º Arjac
                const arjac = characters.find(c => c.name === 'Arjac');
                const abaddon = characters.find(c => c.name === 'Abaddon The Despoiler');
                
                console.log('Arjac:', arjac);
                console.log('Abaddon:', abaddon);
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                const arjacStats = getCharacterStatsFromData('Arjac', 'Common', 8);
                const abaddonStats = getCharacterStatsFromData('Abaddon The Despoiler', 'Common', 8);
                
                console.log('Arjac stats:', arjacStats);
                console.log('Abaddon stats:', abaddonStats);
                
            })
            .catch(error => console.error('Error:', error));
            
        function isCharacter(entry) {
            return entry.baseStats &&
                   entry.attacks &&
                   (!entry.rawInfobox?.Type ||
                    (entry.rawInfobox?.Type && !entry.rawInfobox.Type.includes("Badge") &&
                     !entry.rawInfobox.Type.includes("Component") &&
                     !entry.rawInfobox.Type.includes("Mythic")));
        }
        
        function getCharacterStatsFromData(characterName, rarityName, level) {
            console.log(`üîç –ü–æ–∏—Å–∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è ${characterName} ${rarityName} Level ${level}`);
            
            const character = characters.find(c => c.name === characterName);
            if (!character) {
                console.log(`‚ùå –ü–µ—Ä—Å–æ–Ω–∞–∂ ${characterName} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return null;
            }

            // –ë–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑ baseStats (fallback –µ—Å–ª–∏ –Ω–µ—Ç —Ç–∞–±–ª–∏—Ü)
            const baseStats = {
                hp: parseInt(character.baseStats?.health || character.hp || 100),
                armor: parseInt(character.baseStats?.armour || character.armor || 10),
                dmg: parseInt(character.baseStats?.damage || character.dmg || 15)
            };
            
            console.log(`üìä –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã: HP=${baseStats.hp}, ARM=${baseStats.armor}, DMG=${baseStats.dmg}`);

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –ø–∞—Å—Å–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
            const allTables = [
                ...(character.activeAbility?.tables || []),
                ...(character.passiveAbility?.tables || [])
            ];
            
            console.log(`üìã –ù–∞–π–¥–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: ${allTables.length}`);

            // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–∞–±–ª–∏—Ü —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã –ë–ï–ó –º–Ω–æ–∂–∏—Ç–µ–ª–µ–π
            if (allTables.length === 0) {
                return baseStats;
            }

            // –ò—â–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (Health, Armour, Damage)
            let targetTable = null;
            for (let i = 0; i < allTables.length; i++) {
                const table = allTables[i];
                const headers = table[0];
                const hasHealth = headers.some(h => h.includes('Health') || h.includes('HP'));
                const hasArmour = headers.some(h => h.includes('Armour') || h.includes('Armor'));
                const hasDamage = headers.some(h => h.includes('Damage') && !h.includes('Piercing') && !h.includes('3x'));
                
                console.log(`üìã –¢–∞–±–ª–∏—Ü–∞ ${i}: headers=[${headers.join(', ')}], hasHealth=${hasHealth}, hasArmour=${hasArmour}, hasDamage=${hasDamage}`);
                
                if (hasHealth || hasArmour || hasDamage) {
                    targetTable = table;
                    console.log(`‚úÖ –í—ã–±—Ä–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ ${i}`);
                    break;
                }
            }

            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é —Ç–∞–±–ª–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã
            if (!targetTable) {
                console.log(`‚ùå –ü–æ–¥—Ö–æ–¥—è—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—ã`);
                return baseStats;
            }

            const tableHeaders = targetTable[0];
            console.log(`üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã: [${tableHeaders.join(', ')}]`);
            
            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã –Ω—É–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
            const rarityIndex = tableHeaders.indexOf('Rarity');
            const levelIndex = tableHeaders.indexOf('Level');
            const healthIndex = tableHeaders.findIndex(h => h.includes('Health') || h.includes('HP'));
            const armourIndex = tableHeaders.findIndex(h => h.includes('Armour') || h.includes('Armor'));
            const damageIndex = tableHeaders.findIndex(h => h.includes('Damage') && !h.includes('Piercing') && !h.includes('3x'));
            
            console.log(`üìä –ò–Ω–¥–µ–∫—Å—ã: rarity=${rarityIndex}, level=${levelIndex}, health=${healthIndex}, armour=${armourIndex}, damage=${damageIndex}`);

            // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω—É–∂–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç—å—é –∏ —É—Ä–æ–≤–Ω–µ–º
            let targetRow = null;
            let nextRow = null;
            let tableLevel = null;

            for (let i = 1; i < targetTable.length; i++) {
                const row = targetTable[i];
                if (row[rarityIndex] === rarityName) {
                    const rowLevel = parseInt(row[levelIndex]);
                    if (rowLevel <= level) {
                        if (!targetRow || rowLevel > tableLevel) {
                            targetRow = row;
                            tableLevel = rowLevel;
                            
                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏
                            if (i + 1 < targetTable.length && targetTable[i + 1][rarityIndex] === rarityName) {
                                nextRow = targetTable[i + 1];
                            }
                        }
                    }
                }
            }

            if (!targetRow) {
                console.log(`‚ùå –°—Ç—Ä–æ–∫–∞ –¥–ª—è ${rarityName} Level ${level} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                return baseStats;
            }

            console.log(`üìã –ù–∞–π–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ Level ${tableLevel}: [${targetRow.join(', ')}]`);

            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ
            let hp = baseStats.hp;
            let armor = baseStats.armor;
            let dmg = baseStats.dmg;
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º Health –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            if (healthIndex !== -1) {
                const hpValue = targetRow[healthIndex];
                if (hpValue && typeof hpValue === 'string' && hpValue.includes('-')) {
                    const [min, max] = hpValue.split('-').map(v => parseInt(v.trim()));
                    hp = Math.round((min + max) / 2);
                } else if (hpValue && !isNaN(parseInt(hpValue))) {
                    hp = parseInt(hpValue);
                }
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º Armour –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            if (armourIndex !== -1) {
                const armorValue = targetRow[armourIndex];
                if (armorValue && typeof armorValue === 'string' && armorValue.includes('-')) {
                    const [min, max] = armorValue.split('-').map(v => parseInt(v.trim()));
                    armor = Math.round((min + max) / 2);
                } else if (armorValue && !isNaN(parseInt(armorValue))) {
                    armor = parseInt(armorValue);
                }
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º Damage –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
            if (damageIndex !== -1) {
                const dmgValue = targetRow[damageIndex];
                if (dmgValue && typeof dmgValue === 'string' && dmgValue.includes('-')) {
                    const [min, max] = dmgValue.split('-').map(v => parseInt(v.trim()));
                    dmg = Math.round((min + max) / 2);
                } else if (dmgValue && !isNaN(parseInt(dmgValue))) {
                    dmg = parseInt(dmgValue);
                }
            }
            
            console.log(`üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Å—Ç–∞—Ç—ã –¥–ª—è ${characterName}: HP=${hp}, ARM=${armor}, DMG=${dmg}`);
            return { hp, armor, dmg };
        }
    </script>
</body>
</html>