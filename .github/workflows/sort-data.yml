name: Sort data.json alphabetically

on:
  push:
    branches:
      - main
    paths:
      - 'data.json'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  sort-json:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Sort data.json by name
        run: |
          python3 <<'EOF'
          import json
          
          # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
          with open('data.json', 'r', encoding='utf-8') as f:
              data = json.load(f)
          
          # –°–æ—Ä—Ç–∏—Ä—É–µ–º characters –ø–æ –ø–æ–ª—é name
          if 'characters' in data and isinstance(data['characters'], list):
              data['characters'].sort(key=lambda x: x.get('name', '').lower())
              print(f"‚úì –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ {len(data['characters'])} –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π")
          
          # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
          with open('data.json', 'w', encoding='utf-8') as f:
              json.dump(data, f, ensure_ascii=False, indent=2)
              print("‚úì –§–∞–π–ª data.json –æ–±–Ω–æ–≤–ª—ë–Ω")
          EOF
      
      - name: Check for changes
        id: check_changes
        run: |
          if git diff --quiet data.json; then
            echo "changed=false" >> $GITHUB_OUTPUT
            echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ data.json"
          else
            echo "changed=true" >> $GITHUB_OUTPUT
            echo "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ data.json"
          fi
      
      - name: Commit sorted data
        if: steps.check_changes.outputs.changed == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add data.json
          git commit -m "üîÑ Auto-sort: Sorted characters alphabetically by name"
          git push
